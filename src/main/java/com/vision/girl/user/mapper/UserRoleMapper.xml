<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.vision.girl.user.mapper.UserRoleMapper">
    <!-- 单用户移除角色列表 -->
    <update id="updateUserRoleList" parameterType="java.util.List">
        update re_user_role
        set state=0, update_time = now()
        where state = 1 and user_id in
        <foreach collection="list" item="reUserRole" index="index"
                 separator="," open="(" close=")">
            #{reUserRole.userId}
        </foreach>
        and role_id in
        <foreach collection="list" item="reUserRole" index="index"
                 separator="," open="(" close=")">
            #{reUserRole.roleId}
        </foreach>
    </update>

    <!--单用户所有角色列表 -->
    <select id="selectUserRoleList" resultType="com.vision.girl.user.entity.BdRole">
        SELECT br.*
        FROM re_user_role rur
        JOIN bd_role br ON rur.role_id = br.role_id
        WHERE rur.user_id = #{userId}
        <if test="state != -1">
            AND rur.state = #{state}
        </if>
        AND br.state = 1
    </select>
</mapper>
